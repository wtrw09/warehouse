# æ•°æ®å¯¼å…¥éªŒè¯åˆ†å·¥è¯¦ç»†è¯´æ˜

## ğŸ¯ éªŒè¯èŒè´£æ˜ç¡®åˆ†å·¥

### ğŸ“Š **DataPreview.vue** - å‰ç«¯éªŒè¯å±‚
> **æ‰¿æ‹…å®¢æˆ·ç«¯éªŒè¯èŒè´£ï¼Œæä¾›å®æ—¶éªŒè¯åé¦ˆ**

#### ğŸ” éªŒè¯èŒƒå›´
- âœ… **å¿…å¡«å­—æ®µéªŒè¯**: æ£€æŸ¥requiredå­—æ®µæ˜¯å¦ä¸ºç©º
- âœ… **æ•°æ®é•¿åº¦éªŒè¯**: æ£€æŸ¥å­—æ®µé•¿åº¦æ˜¯å¦è¶…å‡ºmaxLengthé™åˆ¶  
- âœ… **æ•°æ®æ ¼å¼éªŒè¯**: åŸºæœ¬æ ¼å¼æ ¡éªŒï¼ˆé‚®ç®±ã€æ‰‹æœºå·ç­‰ï¼‰
- âœ… **æ•°æ®ç±»å‹éªŒè¯**: æ•°å­—ã€æ—¥æœŸç­‰ç±»å‹è½¬æ¢éªŒè¯
- âœ… **å†…éƒ¨é‡å¤æ£€æŸ¥**: åŒä¸€å¯¼å…¥æ–‡ä»¶å†…çš„é‡å¤æ•°æ®æ£€æµ‹

#### ğŸ¨ ç”¨æˆ·ä½“éªŒ
- ğŸ”´ **é”™è¯¯é«˜äº®**: å®æ—¶æ ‡è®°é”™è¯¯å­—æ®µ
- âš ï¸ **è­¦å‘Šå›¾æ ‡**: å¿…å¡«å­—æ®µç¼ºå¤±æç¤º
- ğŸ“Š **ç»Ÿè®¡ä¿¡æ¯**: æ˜¾ç¤ºæœ‰æ•ˆ/é”™è¯¯æ•°æ®æ•°é‡
- âš¡ **å³æ—¶åé¦ˆ**: ç”¨æˆ·è¾“å…¥æ—¶ç«‹å³éªŒè¯

#### ğŸ’» æŠ€æœ¯å®ç°
```typescript
// å‰ç«¯éªŒè¯ç¤ºä¾‹
const validateClientSide = (data: any[], config: ImportConfig) => {
  const errors: ValidationError[] = [];
  
  data.forEach((row, index) => {
    config.templateFields.forEach(field => {
      // å¿…å¡«éªŒè¯
      if (field.required && !row[field.key]) {
        errors.push({
          row: index + 1,
          field: field.key,
          message: `${field.label}ä¸èƒ½ä¸ºç©º`,
          type: 'required'
        });
      }
      
      // é•¿åº¦éªŒè¯
      if (field.maxLength && row[field.key]?.length > field.maxLength) {
        errors.push({
          row: index + 1,
          field: field.key,
          message: `${field.label}é•¿åº¦ä¸èƒ½è¶…è¿‡${field.maxLength}ä¸ªå­—ç¬¦`,
          type: 'length'
        });
      }
    });
  });
  
  return errors;
};
```

---

### ğŸ” **ValidationResult.vue** - åç«¯éªŒè¯å±‚
> **å¤„ç†æœåŠ¡ç«¯éªŒè¯ç»“æœï¼Œç¡®ä¿ä¸šåŠ¡è§„åˆ™å®Œæ•´æ€§**

#### ğŸ¢ éªŒè¯èŒƒå›´
- âœ… **ä¸šåŠ¡è§„åˆ™éªŒè¯**: å¤æ‚çš„ä¸šåŠ¡é€»è¾‘æ ¡éªŒ
- âœ… **æ•°æ®åº“å”¯ä¸€æ€§**: æ£€æŸ¥æ•°æ®åº“ä¸­æ˜¯å¦å·²å­˜åœ¨
- âœ… **è·¨è¡¨å…³è”éªŒè¯**: å¤–é”®çº¦æŸã€å…³è”æ•°æ®æ£€æŸ¥
- âœ… **æƒé™éªŒè¯**: ç”¨æˆ·æ˜¯å¦æœ‰æƒé™æ“ä½œç‰¹å®šæ•°æ®
- âœ… **æ•°æ®å®Œæ•´æ€§**: ç¡®ä¿æ•°æ®åº“çº¦æŸæ»¡è¶³

#### ğŸ›ï¸ é”™è¯¯å¤„ç†ç­–ç•¥
- ğŸ“ **åœ¨çº¿ç¼–è¾‘**: é”™è¯¯æ•°é‡å°‘æ—¶æä¾›è¡¨æ ¼å†…ç¼–è¾‘
- ğŸ“ **æ–‡ä»¶ä¸‹è½½**: é”™è¯¯æ•°é‡å¤šæ—¶ç”ŸæˆExcelé”™è¯¯æ–‡ä»¶
- âš¡ **å¼ºåˆ¶å¯¼å…¥**: å…è®¸å¿½ç•¥éƒ¨åˆ†é”™è¯¯å¼ºåˆ¶å¯¼å…¥
- ğŸ”„ **é‡æ–°éªŒè¯**: ä¿®æ­£æ•°æ®åé‡æ–°æäº¤éªŒè¯

#### ğŸ› ï¸ æŠ€æœ¯å®ç°
```typescript
// åç«¯éªŒè¯ç»“æœå¤„ç†
interface ServerValidationResult {
  isValid: boolean;
  errors: ServerValidationError[];
  allowForceImport: boolean;
  errorFileUrl?: string;
}

const handleServerValidation = async (data: any[]) => {
  const result = await api.validateImportData(data);
  
  if (result.errors.length > 0) {
    // æ˜¾ç¤ºé”™è¯¯å¤„ç†é€‰é¡¹
    showValidationErrors(result.errors);
    
    if (result.errors.length <= 5) {
      // æä¾›åœ¨çº¿ç¼–è¾‘é€‰é¡¹
      enableInlineEdit(result.errors);
    } else {
      // å»ºè®®ä¸‹è½½æ–‡ä»¶ç¼–è¾‘
      offerFileDownload(result.errorFileUrl);
    }
  } else {
    // éªŒè¯é€šè¿‡ï¼Œæ˜¾ç¤ºå¯¼å…¥æŒ‰é’®
    showImportButton();
  }
};
```

---

## ğŸ”„ éªŒè¯æµç¨‹è®¾è®¡

### 1ï¸âƒ£ æ•°æ®è§£æé˜¶æ®µ
```
ImportUploader â†’ ParsedData[] â†’ DataPreview
```

### 2ï¸âƒ£ å‰ç«¯éªŒè¯é˜¶æ®µ  
```
DataPreview æ‰§è¡Œå®¢æˆ·ç«¯éªŒè¯
â”œâ”€â”€ åŸºç¡€æ ¼å¼æ£€æŸ¥
â”œâ”€â”€ å¿…å¡«å­—æ®µéªŒè¯
â”œâ”€â”€ é•¿åº¦é™åˆ¶æ£€æŸ¥
â””â”€â”€ å†…éƒ¨é‡å¤æ£€æµ‹
```

### 3ï¸âƒ£ åç«¯éªŒè¯é˜¶æ®µ
```
ValidationResult å¤„ç†æœåŠ¡ç«¯éªŒè¯
â”œâ”€â”€ å‘é€æ•°æ®åˆ°åç«¯éªŒè¯API
â”œâ”€â”€ æ¥æ”¶éªŒè¯ç»“æœ
â”œâ”€â”€ æ ¹æ®é”™è¯¯æ•°é‡é€‰æ‹©å¤„ç†ç­–ç•¥
â””â”€â”€ æä¾›é”™è¯¯ä¿®æ­£æ–¹æ¡ˆ
```

### 4ï¸âƒ£ å¯¼å…¥æ‰§è¡Œé˜¶æ®µ
```
éªŒè¯é€šè¿‡ â†’ ImportProgress â†’ ImportResult
```

---

## ğŸ¨ ç”¨æˆ·ä½“éªŒæµç¨‹

```mermaid
graph TD
    A[ç”¨æˆ·ä¸Šä¼ æ–‡ä»¶] --> B[DataPreview å‰ç«¯éªŒè¯]
    B --> C{å‰ç«¯éªŒè¯é€šè¿‡?}
    C -->|âŒ æœ‰é”™è¯¯| D[æ˜¾ç¤ºé”™è¯¯é«˜äº®å’Œç»Ÿè®¡]
    C -->|âœ… é€šè¿‡| E[ValidationResult åç«¯éªŒè¯]
    E --> F{åç«¯éªŒè¯é€šè¿‡?}
    F -->|âŒ æœ‰é”™è¯¯| G[æä¾›é”™è¯¯å¤„ç†é€‰é¡¹]
    F -->|âœ… é€šè¿‡| H[æ˜¾ç¤ºå¼€å§‹å¯¼å…¥æŒ‰é’®]
    G --> I[ç”¨æˆ·ä¿®æ­£é”™è¯¯]
    I --> E
    H --> J[æ‰§è¡Œå¯¼å…¥]
```

---

## ğŸ”§ é…ç½®åŒ–éªŒè¯è§„åˆ™

### ImportConfig éªŒè¯é…ç½®
```typescript
interface FieldConfig {
  key: string;
  label: string;
  required?: boolean;           // å‰ç«¯éªŒè¯ï¼šå¿…å¡«
  maxLength?: number;          // å‰ç«¯éªŒè¯ï¼šé•¿åº¦
  pattern?: RegExp;            // å‰ç«¯éªŒè¯ï¼šæ ¼å¼
  type?: 'string' | 'number' | 'date';  // å‰ç«¯éªŒè¯ï¼šç±»å‹
  
  // åç«¯éªŒè¯é…ç½®
  serverValidation?: {
    unique?: boolean;          // æ•°æ®åº“å”¯ä¸€æ€§
    businessRules?: string[];  // ä¸šåŠ¡è§„åˆ™éªŒè¯å™¨
    permissions?: string[];    // æƒé™æ£€æŸ¥
  };
}
```

---

## ğŸ“‹ æ€»ç»“

### âœ… æ˜ç¡®åˆ†å·¥
- **DataPreview**: ä¸“é—¨è´Ÿè´£å‰ç«¯éªŒè¯ï¼Œæä¾›å³æ—¶åé¦ˆ
- **ValidationResult**: ä¸“é—¨å¤„ç†åç«¯éªŒè¯ç»“æœå’Œé”™è¯¯ä¿®æ­£

### âœ… ä¼˜åŠ¿äº’è¡¥
- **å‰ç«¯éªŒè¯**: å‡å°‘æœåŠ¡å™¨è¯·æ±‚ï¼Œæå‡ç”¨æˆ·ä½“éªŒ
- **åç«¯éªŒè¯**: ç¡®ä¿æ•°æ®å®‰å…¨æ€§å’Œä¸šåŠ¡è§„åˆ™å®Œæ•´æ€§

### âœ… æµç¨‹æ¸…æ™°
- å‰ç«¯éªŒè¯ â†’ åç«¯éªŒè¯ â†’ å¯¼å…¥æ‰§è¡Œ
- æ¯ä¸ªé˜¶æ®µèŒè´£æ˜ç¡®ï¼Œä¸é‡å¤ä¸é—æ¼

è¿™æ ·çš„åˆ†å·¥ç¡®ä¿äº†éªŒè¯åŠŸèƒ½çš„å®Œæ•´æ€§å’Œç”¨æˆ·ä½“éªŒçš„æµç•…æ€§ï¼